<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Devin Merullo">
<meta name="dcterms.date" content="2025-07-16">

<title>Devin Merullo, Ph.D.&nbsp;- The Untold Story of Self-Conscious Intelligence</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Devin Merullo, Ph.D.</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html" rel="" target="">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../writing.html" rel="" target="">
 <span class="menu-text">Writing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../misc.html" rel="" target="">
 <span class="menu-text">Misc.</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Untold Story of Self-Conscious Intelligence</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Devin Merullo </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025-07-16</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<p>“Like Daniel Wolpert says, I’m a motor chauvinist. The nervous system evolved to move, and then everything else is sort of a footnote.” – John W. Krakauer</p>
</blockquote>
<p>I came across this line the other day by chance while listening to a research talk recorded eight years ago from a person I didn’t know about.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> It taps into something I’ve thought about for over a decade, though, so it stuck with me. The professor said it tongue-in-cheek, which somehow makes it ring a little louder. Our minds, our consciousness, our love and our hate– how could this all be about moving?</p>
<p>My initial reaction is that no, the nervous system did not evolve solely to move; it emerged from an evolutionary pressure to respond to the environment, where the ability to move was one of several features that conferred a selective advantage in the organisms that are ancestral to animals. <em>Hmph</em>, I thought, <em>that clever line from the professor caught my attention, but he knows it’s hollow, too.</em> I thought about some other life forms that don’t have nervous systems but <em>do</em> respond to the environment– plants, fungi, bacteria. <em>OK, there is quite a big difference here between animal movement and what we see in these other branches. Maybe I’m not done with this yet.</em></p>
<p>Vertebrate life– animals with a brain and a spinal cord– first began in the waters. What you think of as a “fish” doesn’t really capture the diversity of vertebrates that live underwater. You’re thinking of something from Finding Nemo, and certainly that’s a fish! It’s just that, evolutionarily speaking, “fish” also includes creatures like sharks, eels, manta rays, and something called a lamprey. Lampreys are neither pretty nor friendly, but they do have something in their nervous system that appears for the first time on Earth: the basal ganglia. Despite the definite article in the name, the basal ganglia are a collection of brain structures, not an individual unit, that are grouped together based on a common functioning and developmental origin. Regardless, the basal ganglia are largely conserved– meaning the system hasn’t changed much at all– over 500 million years of evolutionary time, from its emergence in lampreys <em>through to humans today</em>. Let that sink in for a bit.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="files/fish.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><em>Nemo and Dory are fish (left). Lampreys are also fish (right).</em></p>
<p>To have a functional paradigm anywhere in the nervous system, let alone in biology, remain conserved for that long means that it must be doing <em>something</em> right. If I had to sum up the function of the basal ganglia in one word, it would be <em>movement</em>. If I could use two words, those would be <em>action selection</em>. Whenever the brain is trying to decide where, when, or how to move, you can bet that the basal ganglia is involved.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> There are some higher level, cognitive roles for the basal ganglia as well, but those truly are footnotes in this case, as they developed much later in evolutionary time– the basal ganglia in lampreys are for movements, first and foremost.</p>
<p>Lampreys have another part of the vertebrate brain called the thalamus, which functions like a gateway hub to route information around the brain from one source to another, much like a central train station or an international airport. However, unlike the basal ganglia, the thalamus shows drastic changes over the 500 million years from then until now across the other vertebrate groups. Though its particular structure shows many alterations over time, its function as an interconnected signal router remains the same, and the thalamus invariably works closely with the basal ganglia to coordinate movement. While the thalamus is doing many <em>other</em> things beyond movement, such as facilitating sensory processing like vision and hearing, the fact that it arises in the evolutionary timeline in concert with the basal ganglia is consistent with the suggestion that its original, primary advantage was for movement.</p>
<p>That now brings us to the final, and perhaps most interesting, member of this movement troupe: the pallium. I know you haven’t heard this word before. It’s from the Latin for cloak, because the pallium is the outermost part of the brain. Surely, you’re thinking of the neocortex (or maybe just the cortex), that gray, wrinkly, mushy mess, as your conception of what a brain <em>is</em>. Well, prepare for these hot takes, any of which could be their own essay: the neocortex is not the only part of the pallium; the neocortex is not necessary for producing advanced, complex behaviors; and the pallium is only one part of the vertebrate brain. The pallium has a critical role, though: it synthesizes with the basal ganglia and thalamus to coordinate movement. Throughout vertebrate evolution, from lampreys into humans, the pallium shows increasing sophistication at every step, continually adopting a wider and improved array of functions, including consciousness, introspection, and, really, anything else we can think of. The story of vertebrate brain evolution could very well be thought of as the story of the pallium.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="files/neuroanatomy.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><em>Note how the components of the basal ganglia (orange, yellow, and red) and the thalamus (green) reside underneath the neocortex (gray, wrinkly). Image credit: Lim S-J, Fiez JA and Holt LL, CC BY 3.0 <a href="https://creativecommons.org/licenses/by/3.0" class="uri">https://creativecommons.org/licenses/by/3.0</a>, via Wikimedia Commons.</em></p>
<p>Nonetheless, I’m still ready to buy the argument that the pallium was first for movement, and anything else second. While lampreys don’t do math or write screenplays (as far as we can tell), they <em>do</em> move, and they move well. If they couldn’t, after all, they wouldn’t be able to find food or avoid predators, and ultimately, I wouldn’t be able to write this here today, nor could you read it.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> It really makes sense to me that at the dawn of vertebrates, evolution selected the pallio-basal ganglia-thalamic loop<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> as the mechanism most adept for movement, thereby best ensuring survival and reproduction, compared to any competing options now removed from the fossil record that we will never know. An informed reader may notice at this point that I have completely left out discussion of the cerebellum, a brain structure obviously dedicated to movement that is common across all vertebrates. Although it’s certainly an intriguing brain region, I have made this elision because I think the cerebellum is too specialized for movement for the point I want to make later, even though it’s not exclusively involved in movement, either.</p>
<p>If we grant that the primordial function of the pallio-basal ganglia-thalamic loop was for movement and movement alone, the mechanisms of some other innovations throughout vertebrate brain evolution start to make a bit more sense. For instance, the circuits involved in vocal learning and production, including speech and language in humans, appear to have their origins in circuits for motor learning and performance.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Taking this a step further, some hypotheses propose that cognition itself arises from modeling used by the brain to predict and evaluate motor behaviors, such as reaching for a cup or shooting a basketball, which requires an estimate to target the location and modify the effort for a future attempt. It’s not that preposterous of a leap to consider that generalizing this modeling capacity to non-motor actions could engender something like conscious thought.</p>
<p>OK– the vertebrate brain may have been optimized for movement first, but how could this also apply to <em>nervous systems as a whole</em>, which covers much broader territory?</p>
<p>If you could look at us under a microscope along with any other animal on Earth– including creatures like squid, ants, and mosquitoes– you would see identical cell types (which is one way that animals differ from, say, plants or fungi, which have distinct cell structures), and crucially, <em>a uniform implementation of the nervous system</em>.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> I don’t mean that every animal has the same nervous system, because obviously there are countless differences. What I mean is that the fundamental nuts-and-bolts are the same: individual cells called neurons are interconnected and send chemical signals to one another through specialized structures called dendrites and axons. Dendrites look like messy plant roots, as they route information <em>into</em> the neurons. An axon looks like a singular tree trunk, as each neuron contains only one and this routes information <em>out</em> of the neuron. This description summarizes the <em>neuron doctrine</em>, a tenet of modern neuroscience which holds that individual neuronal signalling underpins nervous system function and, ultimately, behavior. It’s worth noting that although the neuron doctrine emerged from a lengthy historical debate, it doesn’t mean it explains everything or that there aren’t competing hypotheses.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="files/neurons-cajal.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><em>Actual neurons of the human brain chemically stained by the neuroscientist Santiago Ramón y Cajal (1852-1934) that led to the acceptance of the neuron doctrine. Image from: Glickstein, M. (2006). Golgi and Cajal: The neuron doctrine and the 100th anniversary of the 1906 Nobel Prize. Current Biology. <a href="https://doi.org/10.1016/j.cub.2006.02.053">10.1016/j.cub.2006.02.053</a></em></p>
<p>Now I can clarify the point I want to make. What if the neuron doctrine <em>doesn’t</em> explain movement? What if it’s the other way around… what if movement explains the neuron doctrine?</p>
<p>To move, an animal’s nervous system first needs to input sensory information, such as what is immediately around it and where it could actually go. Then it needs to integrate this information into some sort of higher-level model that can compute a plan to get to a new location, including the amount of energy to exert and capabilities required (you may notice that many insects avoid water, or that most creatures don’t even try to jump across a large gap). At the final step, the nervous system needs to <em>execute</em> the behavior, somehow physically moving the limbs that support the body and make the action a reality. If you were building a system from scratch to accomplish all of this, how might you go about it?</p>
<p>At the most abstract level, removed from technical details, you would need a system that can interpret the external environment, generate an internal model of the body’s relationship with said environment, and then create the output to make changes to that relationship. Nature has discovered that individual cells (which existed before neurons ever arrived) can achieve this when they can communicate with each other. <em>Communication</em> is the key to the nervous system much more than neurons are. Just look at the immune system and endocrine (hormone) system, which are the other communication systems in animals that use intricate sets of chemicals to modulate various physiological processes. The difference is that these systems don’t directly impinge on <em>behavior</em>, which remains the domain of the nervous system. I’m sure you’ve heard or made comments about “hormones affecting behavior”– yet to be pedantic, and also accurate, hormones themselves don’t affect behavior. They modify the probabilities that <em>neurons</em> will signal in certain ways, which then downstream affects behavior.</p>
<p>We already know, then, that the body can communicate without neurons. To move, though? As far as we see in life on Earth, you need neurons, or something with very similar features.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> I had never, ever thought about it this way before– in high school biology, college neuroscience, PhD behavioural neuroendocrinology, postdoctoral comparative neurobiology– but I have to say, I think I’m convinced. The nervous system has evolved to <em>move</em>, and everything else has developed secondarily.</p>
<p>Sometimes I am so embarrassed by the capabilities of artificial intelligences, with their vastly superior performance in almost anything computational or high-dimensional, that it really makes me feel useless. Other times I am so smug that those intelligences don’t quite, nor will likely ever, fully grasp the nuances of human social behavior or what it means to feel emotion, which grants me some advantage, however small. Now, though, I can rest knowing that I was never <em>meant</em> to be a computer. My own thoughts arose from a dance with this ephemeral world, as my collective matter tested various ways to navigate through it all, not so that I would be able to derive mathematical truths from cosmic patterns, but so that my embodied self would continue to persist. It’s a wonder I can even communicate at all.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<p><em>Your readership is more than enough. Still, if you’d like to <a href="https://buymeacoffee.com/dmerullo" target="_blank">buy me a coffee</a>, it’s the clearest signal to keep writing.</em></p>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="https://www.youtube.com/watch?v=jhOUyVa0XmA" target="_blank">1:08-1:15 here.</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>I hope FanDuel doesn’t get any ideas.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Assuming I’m from this planet, of course.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Clunky phrasing, and the one currently entrenched.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p><a href="https://www.youtube.com/watch?v=DGk7BFPfMT4" target="_blank">Most ancestrally from pectoral motor circuitry in fishes.</a><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>With the exception of the Ctenophores (comb jellies), which appear to have an independently evolved nervous system. I highly recommend <em>Brains Through Time</em> by Striedter &amp; Northcutt for a sweeping summary of vertebrate brain evolution.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Referring to the note above about Ctenophores, their movement-signalling system still has the same goals of other nervous systems, but solves it in a different way.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>This line came to me as a reference to the song “AEIOU And Sometimes Y” by Ebn-Ozn: “There are 178 parent languages on our planet with over 1000 dialects… It’s amazing we communicate at all.”<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>